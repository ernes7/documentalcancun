---
import { Image } from 'astro:assets';
import { gallery } from '../../data/content';
import Section from '../layout/Section.astro';
import Heading from '../ui/Heading.astro';
import FadeIn from '../animation/FadeIn.astro';

// Import gallery images for optimization
import gallery01 from '../../assets/gallery/01.jpg';
import gallery02 from '../../assets/gallery/02.jpg';
import gallery03 from '../../assets/gallery/03.jpg';
import gallery04 from '../../assets/gallery/04.jpg';
import gallery05 from '../../assets/gallery/05.jpg';
import gallery06 from '../../assets/gallery/06.jpg';
import gallery07 from '../../assets/gallery/07.jpg';
import gallery08 from '../../assets/gallery/08.jpg';
import gallery09 from '../../assets/gallery/09.jpg';

const galleryImages = [
  { src: gallery01, alt: gallery.images[0].alt },
  { src: gallery02, alt: gallery.images[1].alt },
  { src: gallery03, alt: gallery.images[2].alt },
  { src: gallery04, alt: gallery.images[3].alt },
  { src: gallery05, alt: gallery.images[4].alt },
  { src: gallery06, alt: gallery.images[5].alt },
  { src: gallery07, alt: gallery.images[6].alt },
  { src: gallery08, alt: gallery.images[7].alt },
  { src: gallery09, alt: gallery.images[8].alt },
];
---

<Section id="gallery" variant="default" padding="xl" bgColor="azul-oscuro">
  <div class="max-w-6xl mx-auto">
    <FadeIn>
      <Heading level={2} size="h2" class="text-center mb-16">
        {gallery.title}
      </Heading>
    </FadeIn>

    <!-- Masonry Grid -->
    <div class="gallery-grid grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6">
      {galleryImages.map((image, index) => {
        // Create visual variety with different sizes
        const isLarge = index === 0 || index === 4 || index === 8;
        const sizeClass = isLarge ? 'row-span-2' : '';

        return (
          <FadeIn delay={0.05 * (index + 1)} direction="up">
            <button
              type="button"
              class={`gallery-item group relative overflow-hidden rounded-xl bg-surface cursor-pointer ${sizeClass} w-full`}
              data-image-index={index}
              aria-label={image.alt}
            >
              <!-- Aspect ratio container -->
              <div class={`${isLarge ? 'aspect-[3/4]' : 'aspect-square'}`}>
                <!-- Optimized gallery image -->
                <Image
                  src={image.src}
                  alt={image.alt}
                  widths={[600, 1200, 1800]}
                  sizes="(max-width: 768px) 50vw, 33vw"
                  quality={95}
                  format="webp"
                  class="absolute inset-0 w-full h-full object-cover"
                  loading="lazy"
                />

                <!-- Hover overlay -->
                <div class="absolute inset-0 bg-primary/10 group-hover:bg-primary/25 transition-colors duration-300"></div>

                <!-- Zoom icon on hover -->
                <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  <div class="w-12 h-12 rounded-full bg-background/80 flex items-center justify-center">
                    <svg class="w-5 h-5 text-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
                    </svg>
                  </div>
                </div>
              </div>
            </button>
          </FadeIn>
        );
      })}
    </div>
  </div>
</Section>

<script>
  import { gsap } from '../../scripts/gsap';

  function initGallery() {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // Add hover scale effect
    const items = document.querySelectorAll('.gallery-item');
    items.forEach((item) => {
      if (prefersReducedMotion) return;

      item.addEventListener('mouseenter', () => {
        gsap.to(item, {
          scale: 1.02,
          duration: 0.3,
          ease: 'power2.out',
        });
      });

      item.addEventListener('mouseleave', () => {
        gsap.to(item, {
          scale: 1,
          duration: 0.3,
          ease: 'power2.out',
        });
      });
    });
  }

  initGallery();
  document.addEventListener('astro:page-load', initGallery);
</script>
