---
interface Props {
  direction?: 'left' | 'right';
  duration?: number;
  delay?: number;
  distance?: string;
  class?: string;
}

const {
  direction = 'left',
  duration = 1,
  delay = 0,
  distance = '100%',
  class: className = '',
} = Astro.props;
---

<div
  class={`slide-in-element overflow-hidden ${className}`}
  data-slide-direction={direction}
  data-slide-duration={duration}
  data-slide-delay={delay}
  data-slide-distance={distance}
>
  <div class="slide-in-content" style={`transform: translateX(${direction === 'left' ? `-${distance}` : distance});`}>
    <slot />
  </div>
</div>

<script>
  import { gsap, ScrollTrigger } from '../../scripts/gsap';

  function initSlideIn() {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const elements = document.querySelectorAll('.slide-in-element:not([data-initialized])');

    elements.forEach((el) => {
      el.setAttribute('data-initialized', 'true');
      const content = el.querySelector('.slide-in-content');
      if (!content) return;

      if (prefersReducedMotion) {
        gsap.set(content, { x: 0 });
        return;
      }

      const duration = parseFloat(el.getAttribute('data-slide-duration') || '1');
      const delay = parseFloat(el.getAttribute('data-slide-delay') || '0');

      gsap.to(content, {
        x: 0,
        duration,
        delay,
        ease: 'power3.out',
        scrollTrigger: {
          trigger: el,
          start: 'top 80%',
          toggleActions: 'play none none none',
        },
      });
    });
  }

  initSlideIn();
  document.addEventListener('astro:page-load', initSlideIn);
</script>
