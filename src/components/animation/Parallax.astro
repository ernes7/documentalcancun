---
interface Props {
  speed?: number;
  class?: string;
}

const {
  speed = 0.3,
  class: className = '',
} = Astro.props;
---

<div
  class={`parallax-element ${className}`}
  data-parallax-speed={speed}
>
  <slot />
</div>

<script>
  import { gsap, ScrollTrigger } from '../../scripts/gsap';

  function initParallax() {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReducedMotion) return;

    const elements = document.querySelectorAll('.parallax-element:not([data-initialized])');

    elements.forEach((el) => {
      el.setAttribute('data-initialized', 'true');
      const speed = parseFloat(el.getAttribute('data-parallax-speed') || '0.3');

      gsap.to(el, {
        y: () => window.innerHeight * speed * -1,
        ease: 'none',
        scrollTrigger: {
          trigger: el,
          start: 'top bottom',
          end: 'bottom top',
          scrub: true,
        },
      });
    });
  }

  initParallax();
  document.addEventListener('astro:page-load', initParallax);
</script>
